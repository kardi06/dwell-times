# Story 1.7: Dwell Time Analytics Charts

## Status
Approved

## Story
**As a** user of the Dwell-Insight analytics platform,
**I want to** view beautiful dwell time analytics charts with demographic breakdowns and time period filtering,
**so that** I can analyze dwell time patterns across different age groups, genders, and time periods.

## Acceptance Criteria
1. **Chart Implementation:**
   - [ ] Implement horizontal bar chart for "Average Dwell Time (Hour)" by gender
   - [ ] Implement line chart for "Average Dwell Time per Week (Hour) by Age and Gender"
   - [ ] Use Chart.js library for beautiful, responsive charts
   - [ ] Support both total dwell time (count) and average dwell time metrics
   - [ ] Display data for Male, Female, and Other gender categories

2. **Time Period Filtering:**
   - [ ] Add dropdown filter for time periods: Day, Week, Monthly, Quarterly, Yearly
   - [ ] Chart reloads automatically when time period is selected
   - [ ] Filter data based on selected time period

3. **Demographic Data Visualization:**
   - [ ] X-axis: Age groups (20-29, 30-39, 40-49, 50-59, Other)
   - [ ] Y-axis: Dwell time (total duration or average duration)
   - [ ] Series: Gender (Male, Female, Other) with distinct colors

4. **Chart Interactivity:**
   - [ ] Hover tooltips showing exact values
   - [ ] Responsive design for different screen sizes
   - [ ] Smooth animations and transitions

## Tasks / Subtasks
- [ ] **Task 1: Chart.js Setup (AC: 1)**
  - [ ] Install and configure Chart.js library
  - [ ] Set up chart container components
  - [ ] Configure chart themes and styling

- [ ] **Task 2: Bar Chart Implementation (AC: 1)**
  - [ ] Create horizontal bar chart for average dwell time by gender
  - [ ] Implement data formatting for gender categories
  - [ ] Add chart title and axis labels

- [ ] **Task 3: Line Chart Implementation (AC: 1)**
  - [ ] Create line chart for average dwell time by age and gender
  - [ ] Implement data formatting for age groups
  - [ ] Add multiple series for different genders

- [ ] **Task 4: Time Period Filtering (AC: 2)**
  - [ ] Create dropdown for time period selection
  - [ ] Implement time period filtering logic
  - [ ] Add chart reload functionality

- [ ] **Task 5: Metric Type Filtering (AC: 1)**
  - [ ] Add dropdown for metric selection (Total vs Average)
  - [ ] Implement data aggregation logic
  - [ ] Update chart Y-axis labels

- [ ] **Task 6: Backend API Development (AC: 3)**
  - [ ] Create analytics endpoint for chart data
  - [ ] Implement SQL aggregation queries
  - [ ] Add time period filtering in queries

## Dev Notes

### Data Models
**Chart Data Interface:**
```typescript
interface ChartDataPoint {
  age_group: string; // "20-29", "30-39", "40-49", "50-59", "other"
  gender: string; // "male", "female", "other"
  total_dwell_time: number; // in seconds
  avg_dwell_time: number; // in seconds
  event_count: number;
}
```

**Camera Events Schema (Key Columns):**
- `age_group_outcome` (VARCHAR(50), nullable)
- `gender_outcome` (VARCHAR(20), nullable)
- `dwell_time` (integer, calculated)
- `utc_time_started_readable` (timestamp)
- `utc_time_ended_readable` (timestamp)
- `created_at` (timestamp with time zone)

### API Specifications
**Chart Data Endpoint:**
- `GET /api/v1/analytics/chart-data`
- Query parameters: time_period, metric_type, chart_type
- Returns aggregated data for chart visualization

### Component Specifications
**Chart Components:**
- Location: `frontend/src/components/Dashboard/Charts/`
- Components: DwellTimeBarChart, DwellTimeLineChart, ChartFilters
- Props: `data: ChartDataPoint[]`, `config: ChartConfig`

### File Locations
- `frontend/src/components/Dashboard/Charts/DwellTimeBarChart.tsx`
- `frontend/src/components/Dashboard/Charts/DwellTimeLineChart.tsx`
- `frontend/src/components/Dashboard/Charts/ChartFilters.tsx`
- `backend/app/api/endpoints/analytics.py`
- `backend/app/services/chart_aggregator.py`

### Technical Constraints
- Must use Chart.js library
- Should handle large datasets efficiently
- Must support responsive design
- Should provide smooth animations
- Must handle null/undefined as "Other"

## Testing
- Unit tests for chart data aggregation
- Integration tests for chart API endpoints
- Frontend component tests for chart rendering
- Performance tests for large datasets

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-29 | 1.0 | Initial story creation | SM |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4

### Debug Log References
- None yet

### Completion Notes List
- None yet

### File List
- None yet 